var $=jQuery,position=new BABYLON.Vector3(0,0,0);$(document).ready(function(){var e,t,r,a,o,n,i,u=6,s=!1,l=0,c={};c[[0,0]]=!0;var B=function(e){var t={render:"p",width:400,height:300,typeNumber:-1,text:e,correctLevel:QRErrorCorrectLevel.H},r=new QRCode(t.typeNumber,t.correctLevel);return r.addData(t.text),r.make(),r},m=function(e){console.log("amkescene");var t=new BABYLON.Scene(e);return t.gravity=new BABYLON.Vector3(0,-.8,0),t.collisionsEnabled=!0,t.fogMode=BABYLON.Scene.FOGMODE_EXP,t.fogDensity=.02,t.fogColor=new BABYLON.Color3(.9,.9,.9),t.clearColor=new BABYLON.Color3(.9,.9,.9),t},d=function(e){console.log("amkefreecamera");var t=new BABYLON.FreeCamera("free",new BABYLON.Vector3(0,5,0),e);return t.minZ=1,t.checkCollisions=!0,t.applyGravity=!0,t.ellipsoid=new BABYLON.Vector3(1,1,1),t},x=function(e,t){var r=new BABYLON.StandardMaterial("groundMat",e),a="textures/groundEmissiveTexture.jpg";r.emissiveTexture=new BABYLON.Texture(a,e),r.emissiveTexture.uScale=t,r.emissiveTexture.vScale=t;var o="textures/groundEmissiveTexture.jpg";r.diffuseTexture=new BABYLON.Texture(o,e),r.diffuseTexture.uScale=t,r.diffuseTexture.vScale=t;var n="textures/groundBumpTexture.jpg";r.bumpTexture=new BABYLON.Texture(n,e),r.bumpTexture.uScale=t,r.bumpTexture.vScale=t;var i="textures/groundSpecularTexture.jpg";return r.specularTexture=new BABYLON.Texture(i,e),r.specularTexture.uScale=t,r.specularTexture.vScale=t,r},f=function(e,t,r,a,o,n,i,u){console.log("meshGround");var s=new BABYLON.Mesh(e,o),l=BABYLON.VertexData.CreateGroundOffset(t,r,a,i,u);return l.applyToMesh(s,n),s},p=function(e,t,r,a,o,u){console.log("amkeGroundOff");var s="ground";s+=l,l++,n=(e+2)*t,i=(e+2)*t;var c=1,B=!1,m=f(s,n,i,c,r,B,o,u);return m.material=a,m.checkCollisions=!0,m},v=function(e){console.log("makeCubeMaterial");var t=new BABYLON.StandardMaterial("matWall",e);return t.diffuseTexture=new BABYLON.Texture("textures/wallDiffuseTexture1.png",e),t.diffuseTexture.uScale=1,t.diffuseTexture.vScale=1,t.emissiveTexture=new BABYLON.Texture("textures/wallDiffuseTexture1.png",e),t.emissiveTexture.uScale=1,t.emissiveTexture.vScale=1,t.bumpTexture=new BABYLON.Texture("textures/wallBumpTexture2.png",e),t.bumpTexture.uScale=1,t.bumpTexture.vScale=1,t},w=function(e,t,r){console.log("makeCubeBase");var a=BABYLON.Mesh.CreateBox("mainCube",t,e);return a.subMeshes=[],a.subMeshes.push(new BABYLON.SubMesh(0,0,4,0,6,a)),a.subMeshes.push(new BABYLON.SubMesh(1,4,20,6,30,a)),a.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(0,-Math.PI/2,0),a.material=r,a.checkCollisions=!0,a.setEnabled(!1),a},h=function(e){return console.log("randomFromArray"),e[Math.floor(Math.random()*e.length)]},g=function(e,t,r,a,o,n){console.log("createPainting");var i=e.x<0?1:-1,u=[4/3,1.5,16/9,5/4,5/3,1],s=(u[Math.floor(Math.random()*u.length)],Math.random(),n/2);if(Math.random()<.5){var l=h(images);l.aspectRatio=u[Math.floor(Math.random()*u.length)];var c=new BABYLON.Mesh.CreateBox(l.url,5,o);c.rotation.x=Math.PI/2,c.scaling=new BABYLON.Vector3(.02,.6*l.aspectRatio,.6),c.position=new BABYLON.Vector3(e.x+s,e.y,e.z),c.material=new BABYLON.StandardMaterial("matPaint",o),c.material.emissiveTexture=new BABYLON.Texture(l.url,o),c.isOnCenter=a}if(Math.random()<.5){var l=h(images);l.aspectRatio=u[Math.floor(Math.random()*u.length)];var c=new BABYLON.Mesh.CreateBox(l.url,5,o);c.rotation.x=i*(Math.PI/2),c.rotation.y=i*(Math.PI/2),c.scaling=new BABYLON.Vector3(.02,.6*l.aspectRatio,.6),c.position=new BABYLON.Vector3(e.x,e.y,e.z-s),c.material=new BABYLON.StandardMaterial("matPaint",o),c.material.emissiveTexture=new BABYLON.Texture(l.url,o),c.isOnCenter=a}if(Math.random()<.5){var l=h(images);l.aspectRatio=u[Math.floor(Math.random()*u.length)];var c=new BABYLON.Mesh.CreateBox(l.url,5,o);c.rotation.x=i*(-Math.PI/2),c.rotation.y=i*(Math.PI/2),c.scaling=new BABYLON.Vector3(.02,.6*l.aspectRatio,.6),c.position=new BABYLON.Vector3(e.x,e.y,e.z+s),c.material=new BABYLON.StandardMaterial("matPaint",o),c.material.emissiveTexture=new BABYLON.Texture(l.url,o),c.isOnCenter=a}if(Math.random()<.5){var l=h(images);l.aspectRatio=u[Math.floor(Math.random()*u.length)];var c=new BABYLON.Mesh.CreateBox(l.url,5,o);c.rotation.x=i*(Math.PI/2),c.rotation.y=i*(-Math.PI/2),c.rotation.z=i*(Math.PI/2),c.scaling=new BABYLON.Vector3(.02,.6*l.aspectRatio,.6),c.position=new BABYLON.Vector3(e.x-s,e.y,e.z),c.material=new BABYLON.StandardMaterial("matPaint",o),c.material.emissiveTexture=new BABYLON.Texture(l.url,o),c.isOnCenter=a}},O=function(e,t,r,a,o,n,i,u){console.log("makemazeoffset");for(var s,l=[],c=0;t>c;c++)for(var B=0;t>B;B++)if(o.isDark(c,B)&&Math.random()>.5){s=e.clone("ClonedCube"+c+B+i+u);var m=r/2+(c-t/2)*r,d=r/2,x=r/2+(B-t/2)*r,f=new BABYLON.Vector3(m+i,d,x+u);s.position=f,l.push(s),g(f,5,5,!0,a,r)}var p=mergeMeshes("maze"+i+u,l,a);return p.checkCollisions=!0,p.material=n,p},L=function(e,t,r,a,o,n,i,u,s){console.log("createsectionoff"),p(t,r,a,o,u,s),O(e,t,r,a,i,n,u,s)},A=function(t){var l=B(t),f=l.getModuleCount(),p=m(r);e=d(p);var h=x(p,f),g=v(p),O=w(p,u,g);L(O,f,u,p,h,g,l,0,0);var A=u/2+(7-f/2)*u,M=u/2+(1-f/2)*u;e.position=new BABYLON.Vector3(A,2.5,M);var N=function(e,t){return sign=e>=0?1:-1,div=Math.floor(e/t),div},Y=function(){console.log("make new group");var e=80,t=position.x,r=position.z,a=i/2+t,o=n/2+r,s=a+e,B=a-e,m=o+e,d=o-e,x=N(s,i),v=N(B,i),w=N(m,n),A=N(d,n),M=[[x,w],[x,A],[v,w],[v,A]];for(t=0;t<M.length;t++)xarr=M[t],quadX=xarr[0],quadZ=xarr[1],"undefined"==typeof c[xarr]&&(L(O,f,u,p,h,g,l,quadX*i,quadZ*n),c[xarr]=!0);setTimeout(function(){window.requestAnimationFrame(Y)},100)};return window.addEventListener("keydown",function(t){console.log("keyDown"),32===t.keyCode&&(s?(s=!1,animateCameraPositionAndRotation(e,e.position,a,e.rotation,o)):(s=!0,a=e.position,o=e.rotation,animateCameraPositionAndRotation(e,e.position,new BABYLON.Vector3(16,400,15),e.rotation,new BABYLON.Vector3(1.4912565104551518,-1.5709696842019767,e.rotation.z))));37===t.keyCode&&(t.preventDefault(),t.stopPropagation(),e.cameraRotation.y-=.05),39===t.keyCode&&(t.preventDefault(),t.stopPropagation(),e.cameraRotation.y+=.05),console.log(e.position)},!1),Y(position),p};window.onload=function(){t=document.getElementById("canvas"),BABYLON.Engine.isSupported()?(r=new BABYLON.Engine(t,!0),window.addEventListener("resize",function(){r.resize()}),gallery=A("Boston Arts"),gallery.activeCamera.attachControl(t),r.runRenderLoop(function(){gallery.render(),position=gallery.activeCamera.position})):window.alert("Browser is not supported")}});